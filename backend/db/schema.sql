PRAGMA foreign_keys = ON;
CREATE TABLE IF NOT EXISTS users (id INTEGER PRIMARY KEY AUTOINCREMENT,email TEXT UNIQUE NOT NULL,password_hash TEXT NOT NULL,name TEXT NOT NULL,role TEXT NOT NULL DEFAULT 'user',created_at DATETIME DEFAULT CURRENT_TIMESTAMP);
CREATE TABLE IF NOT EXISTS species (id INTEGER PRIMARY KEY AUTOINCREMENT,name TEXT UNIQUE NOT NULL);
CREATE TABLE IF NOT EXISTS breeds (id INTEGER PRIMARY KEY AUTOINCREMENT,species_id INTEGER NOT NULL,name TEXT NOT NULL,UNIQUE(species_id,name),FOREIGN KEY (species_id) REFERENCES species(id) ON DELETE CASCADE);
CREATE TABLE IF NOT EXISTS farms (id INTEGER PRIMARY KEY AUTOINCREMENT,name TEXT NOT NULL,location TEXT);
CREATE TABLE IF NOT EXISTS animals (id INTEGER PRIMARY KEY AUTOINCREMENT,tag_code TEXT UNIQUE NOT NULL,name TEXT,sex TEXT CHECK (sex IN ('M','F','U')) NOT NULL DEFAULT 'U',birth_date DATE,species_id INTEGER,breed_id INTEGER,farm_id INTEGER,color TEXT,status TEXT NOT NULL DEFAULT 'activo',sire_id INTEGER,dam_id INTEGER,created_at DATETIME DEFAULT CURRENT_TIMESTAMP,updated_at DATETIME,FOREIGN KEY (species_id) REFERENCES species(id),FOREIGN KEY (breed_id) REFERENCES breeds(id),FOREIGN KEY (farm_id) REFERENCES farms(id),FOREIGN KEY (sire_id) REFERENCES animals(id),FOREIGN KEY (dam_id) REFERENCES animals(id));
CREATE TABLE IF NOT EXISTS animal_weights (id INTEGER PRIMARY KEY AUTOINCREMENT,animal_id INTEGER NOT NULL,date DATE,weight_kg REAL NOT NULL,FOREIGN KEY (animal_id) REFERENCES animals(id) ON DELETE CASCADE);
CREATE TABLE IF NOT EXISTS animal_vaccinations (id INTEGER PRIMARY KEY AUTOINCREMENT,animal_id INTEGER NOT NULL,date DATE,vaccine TEXT NOT NULL,notes TEXT,FOREIGN KEY (animal_id) REFERENCES animals(id) ON DELETE CASCADE);
CREATE TABLE IF NOT EXISTS photos (id INTEGER PRIMARY KEY AUTOINCREMENT,animal_id INTEGER NOT NULL,filename TEXT NOT NULL,uploaded_at DATETIME DEFAULT CURRENT_TIMESTAMP,FOREIGN KEY (animal_id) REFERENCES animals(id) ON DELETE CASCADE);
CREATE TABLE IF NOT EXISTS catalog_items (id INTEGER PRIMARY KEY AUTOINCREMENT,animal_id INTEGER UNIQUE NOT NULL,visible INTEGER NOT NULL DEFAULT 1,created_at DATETIME DEFAULT CURRENT_TIMESTAMP,FOREIGN KEY (animal_id) REFERENCES animals(id) ON DELETE CASCADE);